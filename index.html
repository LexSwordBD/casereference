<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CaseReference | Smart Legal Research</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Merriweather:wght@300;400;700&family=Hind+Siliguri:wght@400;500;600&display=swap');
        
        :root {
            --primary-grad: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            --accent-color: #d35400;
            --text-dark: #2c3e50;
            --app-btn-color: #27ae60;
        }

        body { background-color: #f4f7f6; font-family: 'Poppins', sans-serif; overflow-x: hidden; }
        
        /* Navbar */
        .navbar { background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 12px 0; transition: 0.3s; }
        .navbar-brand { font-size: 24px; font-weight: 700; color: var(--text-dark) !important; font-family: 'Merriweather', serif; }
        .navbar-brand span { color: var(--accent-color); }
        .nav-link { font-weight: 500; color: #555; margin: 0 8px; font-size: 15px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-app-download { border: 1px solid var(--app-btn-color); color: var(--app-btn-color); border-radius: 50px; padding: 5px 15px; transition: 0.3s; font-size: 14px; font-weight: 600; }
        .btn-app-download:hover { background: var(--app-btn-color); color: white; }

        /* Hero Section (Dynamic Sizing) */
        .hero-section { 
            background: var(--primary-grad); 
            padding: 80px 15px 100px 15px; 
            text-align: center; color: white; 
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px;
            transition: all 0.5s ease-in-out;
            min-height: 80vh; /* Default large height */
            display: flex; flex-direction: column; justify-content: center;
        }
        
        /* Shrunk state for Hero (After Search) */
        .hero-section.shrunk {
            min-height: auto;
            padding: 30px 15px 50px 15px;
        }
        .hero-section.shrunk .hero-title, 
        .hero-section.shrunk .hero-subtitle {
            display: none; /* Hide titles to save space */
        }

        .hero-title { font-size: 42px; font-weight: 700; margin-bottom: 10px; font-family: 'Merriweather', serif; }
        .hero-subtitle { font-size: 16px; opacity: 0.9; margin-bottom: 40px; letter-spacing: 1px; }

        /* Search Styles */
        .search-container { max-width: 900px; margin: 0 auto; position: relative; }
        
        .search-controls { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; align-items: center; flex-wrap: wrap; }
        
        .law-filter-input {
            width: 350px; border-radius: 30px; border: none; padding: 12px 25px;
            font-size: 14px; color: #2c3e50; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            background-color: #fff; outline: none; transition: 0.3s;
            font-family: 'Poppins', 'Hind Siliguri', sans-serif;
        }
        .law-filter-input:focus { transform: scale(1.02); }

        .search-wrapper {
            background: #fff; border-radius: 50px; padding: 5px 5px 5px 25px;
            display: flex; align-items: center; box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            transition: 0.3s; height: 65px;
        }
        .search-input { border: none; outline: none; flex-grow: 1; font-size: 18px; color: #333; background: transparent; height: 100%; font-family: 'Poppins', 'Hind Siliguri', sans-serif; }
        
        .btn-filter { background: none; border: none; color: #777; font-size: 20px; padding: 0 20px; border-left: 1px solid #eee; height: 35px; display: flex; align-items: center; cursor: pointer; }
        .btn-search { 
            background: var(--accent-color); color: white; border: none;
            width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 20px; flex-shrink: 0; box-shadow: 0 4px 15px rgba(211, 84, 0, 0.4); cursor: pointer;
        }
        .btn-search:active { transform: scale(0.95); }

        .exact-match-wrapper { display: flex; align-items: center; color: rgba(255,255,255,0.8); font-size: 14px; margin-left: 10px; background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); }
        .form-check-input { cursor: pointer; margin-right: 8px; }

        .adv-search-panel { display: none; background: #fff; border-radius: 12px; padding: 25px; margin-top: 15px; text-align: left; color: #333; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }

        /* Features */
        .features-section { padding: 40px 15px; background: #fff; margin-top: -50px; border-radius: 20px; position: relative; z-index: 10; max-width: 1000px; margin-left: auto; margin-right: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .feature-icon { font-size: 28px; color: var(--accent-color); margin-bottom: 10px; }
        .feature-title { font-weight: 600; font-size: 16px; color: var(--text-dark); }

        /* Result Card (List View) */
        .result-card { 
            background: white; padding: 30px; border-radius: 10px; 
            margin-bottom: 20px; border-left: 5px solid var(--accent-color); 
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); cursor: pointer; transition: 0.2s; 
        }
        .result-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        
        .headnote-text { 
            text-align: justify; font-size: 16px; line-height: 1.7; color: #2c3e50; margin-top: 15px;
            white-space: pre-wrap; font-family: 'Merriweather', 'Hind Siliguri', serif;
            /* Full text show removed line-clamp */
        }
        .highlight { background-color: #ffeb3b; padding: 0 2px; border-radius: 2px; font-weight: bold; }
        .parallel-cite { font-size: 13px; color: #555; margin-left: 10px; font-style: italic; }

        /* Packages */
        .packages-section { padding: 60px 15px; }
        .section-title { text-align: center; font-weight: 700; margin-bottom: 40px; color: var(--text-dark); }
        .package-card { background: white; border-radius: 15px; padding: 30px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 20px; transition: 0.3s; position: relative; overflow: hidden; }
        .package-card:hover { transform: translateY(-5px); border: 1px solid var(--accent-color); }
        .package-card.best-value { border: 2px solid var(--accent-color); }
        .badge-best { position: absolute; top: 15px; right: -30px; background: var(--accent-color); color: white; padding: 5px 30px; transform: rotate(45deg); font-size: 12px; font-weight: bold; }
        .btn-pay { display: block; width: 100%; background: var(--text-dark); color: white; padding: 12px; border-radius: 8px; text-decoration: none; margin-top: 20px; font-weight: 600; transition: 0.3s; }
        .btn-pay:hover { background: var(--accent-color); }

        footer { background: #1a1a1a; color: #bbb; padding: 50px 0; font-size: 14px; }
        .whatsapp-float { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background-color: #25d366; color: white; border-radius: 50%; text-align: center; line-height: 60px; font-size: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 1000; transition: 0.3s; }
        .whatsapp-float:hover { transform: scale(1.1); }

        .modal-header { background: var(--text-dark); color: white; border-bottom: none; }
        .modal-content { border-radius: 15px; border: none; overflow: hidden; }
        .form-label { font-weight: 600; font-size: 13px; text-transform: uppercase; color: #777; margin-bottom: 5px; }
        .form-control, .form-select { border-radius: 8px; padding: 12px; font-size: 15px; border: 1px solid #eee; background: #f9f9f9; }
        .btn-close-white { filter: invert(1); }

        .pagination { justify-content: center; margin-top: 30px; padding-bottom: 50px; }
        .page-link { color: var(--text-dark); border: none; margin: 0 5px; border-radius: 5px; font-weight: 600; }
        .page-link:hover, .page-item.active .page-link { background-color: var(--accent-color); color: white; }
        .page-item.disabled .page-link { background-color: transparent; color: #ccc; }

        @media (max-width: 768px) {
            .hero-title { font-size: 28px; }
            .hero-section { padding-top: 100px; padding-bottom: 40px; }
            .features-section { margin-top: 20px !important; width: 95%; }
            .search-input { font-size: 16px; padding-left: 15px; }
            .search-wrapper { height: 55px; }
            .search-controls { flex-direction: column; width: 100%; }
            
            /* Mobile Search Input Separation */
            .law-filter-input { 
                width: 100%; 
                margin-bottom: 10px; /* Gap added */
                border: 1px solid #eee; /* Explicit border for mobile */
            }
            
            .col-6 { padding: 5px; }
            .navbar-nav { text-align: center; margin-top: 10px; }
            .btn-app-download { margin: 10px auto; display: inline-block; }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="location.reload()">Case<span>Reference</span></a>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item"><a class="nav-link nav-link-close" href="#" onclick="resetHome()">Home</a></li>
                    <li class="nav-item"><a class="nav-link nav-link-close" href="#" onclick="showMyBookmarks()">Bookmarks</a></li>
                    <li class="nav-item"><a class="nav-link nav-link-close" href="#packages">Pricing</a></li>
                    <li class="nav-item"><a class="nav-link nav-link-close" href="#contact">Contact</a></li>
                    <li class="nav-item">
                        <a class="nav-link btn-app-download" href="#" data-bs-toggle="modal" data-bs-target="#appModal">
                            <i class="fab fa-android"></i> Get App
                        </a>
                    </li>
                    <li class="nav-item ms-lg-3 mt-3 mt-lg-0" id="authDiv"></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="hero-section" id="homeSection">
        <div class="container">
            <h1 class="hero-title">Welcome to Case Reference</h1>
            <p class="hero-subtitle">Smart Legal Research Database for Professionals</p>
            
            <div class="search-container">
                <div class="search-controls">
                    <input class="law-filter-input" list="lawList" id="lawFilterInput" placeholder="Filter by Law (e.g. Penal Code)" onchange="triggerSearch(1)">
                    <datalist id="lawList">
                        <option value="Constitution of Bangladesh (à¦¸à¦‚à¦¬à¦¿à¦§à¦¾à¦¨)">
                        <option value="Code of Civil Procedure (CPC/à¦¦à§‡à¦“à§Ÿà¦¾à¦¨à§€)">
                        <option value="Code of Criminal Procedure (CrPC/à¦«à§Œà¦œà¦¦à¦¾à¦°à§€)">
                        <option value="Penal Code (à¦¦à¦£à§à¦¡à¦¬à¦¿à¦§à¦¿)">
                        <option value="Evidence Act (à¦¸à¦¾à¦•à§à¦·à§à¦¯ à¦†à¦‡à¦¨)">
                        <option value="Limitation Act (à¦¤à¦¾à¦®à¦¾à¦¦à¦¿ à¦†à¦‡à¦¨)">
                        <option value="Specific Relief Act (à¦¸à§à¦¨à¦¿à¦°à§à¦¦à¦¿à¦·à§à¦Ÿ à¦ªà§à¦°à¦¤à¦¿à¦•à¦¾à¦°)">
                        <option value="Nari O Shishu Nirjatan Daman Ain (à¦¨à¦¾à¦°à§€ à¦“ à¦¶à¦¿à¦¶à§)">
                        <option value="Artha Rin Adalat Ain (à¦…à¦°à§à¦¥ à¦‹à¦£ à¦†à¦¦à¦¾à¦²à¦¤)">
                        <option value="Digital Security Act (à¦¡à¦¿à¦œà¦¿à¦Ÿà¦¾à¦² à¦¨à¦¿à¦°à¦¾à¦ªà¦¤à§à¦¤à¦¾)">
                        <option value="Narcotics Control Act (à¦®à¦¾à¦¦à¦• à¦¦à§à¦°à¦¬à§à¦¯ à¦¨à¦¿à§Ÿà¦¨à§à¦¤à§à¦°à¦£)">
                        <option value="Special Powers Act (à¦¬à¦¿à¦¶à§‡à¦· à¦•à§à¦·à¦®à¦¤à¦¾)">
                        <option value="Anti-Terrorism Act (à¦¸à¦¨à§à¦¤à§à¦°à¦¾à¦¸ à¦¬à¦¿à¦°à§‹à¦§à§€)">
                        <option value="Arms Act (à¦…à¦¸à§à¦¤à§à¦° à¦†à¦‡à¦¨)">
                        <option value="Ain Srinkhola Bighnokari (à¦¦à§à¦°à§à¦¤ à¦¬à¦¿à¦šà¦¾à¦°)">
                        <option value="Mobile Court Act (à¦®à§‹à¦¬à¦¾à¦‡à¦² à¦•à§‹à¦°à§à¦Ÿ)">
                        <option value="Transfer of Property Act (à¦¸à¦®à§à¦ªà¦¤à§à¦¤à¦¿ à¦¹à¦¸à§à¦¤à¦¾à¦¨à§à¦¤à¦°)">
                        <option value="Contract Act (à¦šà§à¦•à§à¦¤à¦¿ à¦†à¦‡à¦¨)">
                        <option value="Registration Act (à¦°à§‡à¦œà¦¿à¦¸à§à¦Ÿà§à¦°à§‡à¦¶à¦¨)">
                        <option value="State Acquisition & Tenancy Act (à¦ªà§à¦°à¦œà¦¾à¦¸à§à¦¬à¦¤à§à¦¬)">
                        <option value="Vested Property Return Act (à¦…à¦°à§à¦ªà¦¿à¦¤ à¦¸à¦®à§à¦ªà¦¤à§à¦¤à¦¿)">
                        <option value="Trust Act (à¦Ÿà§à¦°à¦¾à¦¸à§à¦Ÿ à¦†à¦‡à¦¨)">
                        <option value="Muslim Family Laws (à¦®à§à¦¸à¦²à¦¿à¦® à¦ªà¦¾à¦°à¦¿à¦¬à¦¾à¦°à¦¿à¦• à¦†à¦‡à¦¨)">
                        <option value="Family Courts Ordinance (à¦ªà¦¾à¦°à¦¿à¦¬à¦¾à¦°à¦¿à¦• à¦†à¦¦à¦¾à¦²à¦¤)">
                        <option value="Guardians and Wards Act (à¦…à¦­à¦¿à¦­à¦¾à¦¬à¦• à¦“ à¦ªà§à¦°à¦¤à¦¿à¦ªà¦¾à¦²à§à¦¯)">
                        <option value="Hindu Law (à¦¹à¦¿à¦¨à§à¦¦à§ à¦†à¦‡à¦¨)">
                        <option value="Negotiable Instruments Act (NI Act/à¦šà§‡à¦• à¦¡à¦¿à¦œà¦…à¦¨à¦¾à¦°)">
                        <option value="Bangladesh Labor Act (à¦¶à§à¦°à¦® à¦†à¦‡à¦¨)">
                        <option value="Companies Act (à¦•à§‹à¦®à§à¦ªà¦¾à¦¨à¦¿ à¦†à¦‡à¦¨)">
                        <option value="Bank Company Act (à¦¬à§à¦¯à¦¾à¦‚à¦• à¦•à§‹à¦®à§à¦ªà¦¾à¦¨à¦¿)">
                        <option value="Bankruptcy Act (à¦¦à§‡à¦‰à¦²à¦¿à§Ÿà¦¾ à¦†à¦‡à¦¨)">
                        <option value="VAT Act (à¦­à§à¦¯à¦¾à¦Ÿ à¦†à¦‡à¦¨)">
                        <option value="Income Tax Ordinance (à¦†à§Ÿà¦•à¦°)">
                        <option value="Customs Act (à¦•à¦¾à¦¸à§à¦Ÿà¦®à¦¸)">
                        <option value="Right to Information Act (à¦¤à¦¥à§à¦¯ à¦…à¦§à¦¿à¦•à¦¾à¦°)">
                        <option value="Road Transport Act (à¦¸à§œà¦• à¦ªà¦°à¦¿à¦¬à¦¹à¦¨)">
                    </datalist>

                    <div class="exact-match-wrapper">
                        <input class="form-check-input" type="checkbox" id="exactMatchToggle">
                        <label class="form-check-label" for="exactMatchToggle">Exact Match</label>
                    </div>
                </div>

                <div class="search-wrapper">
                    <input type="text" id="searchInput" class="search-input" maxlength="80" placeholder="Search keywords (e.g. Amendment, Bail, Fraud)...">
                    <button class="btn-filter" onclick="toggleAdvSearch()" title="Advanced Filters"><i class="fas fa-sliders-h fa-lg"></i></button>
                    <button class="btn-search ms-2" onclick="triggerSearch(1)"><i class="fas fa-search"></i></button>
                </div>

                <div class="adv-search-panel" id="advSearchForm">
                    <h6 class="text-primary mb-3 border-bottom pb-2 small fw-bold">CITATION SEARCH (EXACT)</h6>
                    <div class="row g-2">
                        <div class="col-6 col-md-3"><select id="advJournal" class="form-select form-select-sm"><option value="">Journal</option><option>DLR</option><option>BLD</option><option>ADC</option><option>MLR</option><option>BLC</option></select></div>
                        <div class="col-6 col-md-2"><input type="text" id="advVol" class="form-control form-control-sm" placeholder="Vol"></div>
                        <div class="col-6 col-md-3"><select id="advDiv" class="form-select form-select-sm"><option value="">Div</option><option>AD</option><option>HCD</option></select></div>
                        <div class="col-6 col-md-2"><input type="text" id="advPage" class="form-control form-control-sm" placeholder="Page"></div>
                        <div class="col-12 col-md-2"><button class="btn btn-dark btn-sm w-100" onclick="triggerSearch(1, 'advanced')">Find</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="features-section" id="featuresSection">
        <div class="row text-center g-4">
            <div class="col-6 col-md-3"><i class="fas fa-bolt feature-icon"></i><div class="feature-title">Fast Search</div></div>
            <div class="col-6 col-md-3"><i class="fas fa-gavel feature-icon"></i><div class="feature-title">All Laws</div></div>
            <div class="col-6 col-md-3"><i class="fas fa-mobile-alt feature-icon"></i><div class="feature-title">Mobile Ready</div></div>
            <div class="col-6 col-md-3"><i class="fas fa-headset feature-icon"></i><div class="feature-title">24/7 Support</div></div>
        </div>
    </div>

    <div class="container mt-4">
        <div id="resultsArea"></div>
        <nav id="paginationNav" style="display:none;"><ul class="pagination" id="paginationList"></ul></nav>
        <div id="readerView" class="p-4 bg-white rounded shadow-sm border" style="display:none; margin-bottom:50px; font-family: 'Times New Roman', serif;"></div>
        <div id="bookmarkArea" style="display:none;" class="mb-5"><h4 class="mb-4 border-bottom pb-2"><i class="fas fa-bookmark text-warning"></i> Saved Judgments</h4><div id="bookmarkList"></div></div>
        
        <div id="paywallMsg" class="text-center py-5 bg-white rounded shadow-sm border" style="display:none; margin-bottom:50px;">
            <i class="fas fa-crown fa-3x text-warning mb-3"></i>
            <h3>Premium Access Required</h3>
            <p class="text-muted">Please subscribe to a plan to read this judgment.</p>
            <a href="#packages" class="btn btn-dark rounded-pill px-5 mt-2">View Plans</a>
        </div>
    </div>

    <div class="packages-section" id="packages">
        <div class="container">
            <h2 class="section-title">Subscription <span style="color:var(--accent-color)">Plans</span></h2>
            <div class="row g-4 justify-content-center">
                <div class="col-md-3 col-sm-6">
                    <div class="package-card">
                        <i class="fas fa-calendar-day fa-2x text-secondary mb-3"></i>
                        <h5>Monthly</h5>
                        <div class="h3 fw-bold my-2">199à§³</div>
                        <a href="https://shop.bkash.com/ak-jurist-law-firm01911008518/pay/bdt199/4NosNL" target="_blank" class="btn-pay">Subscribe</a>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="package-card best-value">
                        <div class="badge-best">POPULAR</div>
                        <i class="fas fa-calendar-alt fa-2x text-secondary mb-3"></i>
                        <h5>Quarterly</h5>
                        <div class="h3 fw-bold my-2">499à§³</div>
                        <a href="https://shop.bkash.com/ak-jurist-law-firm01911008518/pay/bdt499/IxcDIa" target="_blank" class="btn-pay">Subscribe</a>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="package-card">
                        <i class="fas fa-calendar-check fa-2x text-secondary mb-3"></i>
                        <h5>Half-Yearly</h5>
                        <div class="h3 fw-bold my-2">700à§³</div>
                        <a href="https://shop.bkash.com/ak-jurist-law-firm01911008518/pay/bdt700/LO7ESu" target="_blank" class="btn-pay">Subscribe</a>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="package-card">
                        <i class="fas fa-award fa-2x text-secondary mb-3"></i>
                        <h5>Yearly</h5>
                        <div class="h3 fw-bold my-2">1200à§³</div>
                        <a href="https://shop.bkash.com/ak-jurist-law-firm01911008518/pay/bdt1200/O3FBxR" target="_blank" class="btn-pay">Subscribe</a>
                    </div>
                </div>
            </div>
            <div class="text-center mt-5">
                <button class="btn btn-success btn-lg px-5 rounded-pill shadow" data-bs-toggle="modal" data-bs-target="#paymentModal">
                    <i class="fas fa-check-circle me-2"></i> Confirm Payment
                </button>
            </div>
        </div>
    </div>

    <footer id="contact">
        <div class="container text-center">
            <h5 class="fw-bold text-white mb-3">CaseReference BD</h5>
            <p class="mb-1 opacity-75">Bashundhara Riverview, Dhaka.</p>
            <p class="mb-3 opacity-75">Email: legalvoicebd@gmail.com | Helpline: 01911 008 518</p>
            <hr style="border-color: #444; width: 50%; margin: 20px auto;">
            <p class="mb-0 small opacity-50">&copy; 2026 CaseReference. All Rights Reserved.</p>
        </div>
    </footer>

    <a href="https://wa.me/8801911008518" class="whatsapp-float" target="_blank"><i class="fab fa-whatsapp"></i></a>

    <div class="modal fade" id="appModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center p-5 border-0">
                <div class="modal-body">
                    <i class="fas fa-mobile-alt fa-4x text-success mb-3"></i>
                    <h3 class="fw-bold">Coming Soon!</h3>
                    <p class="text-muted mt-3">Our dedicated Android App is currently under development. Stay tuned for the best legal research experience on your phone.</p>
                    <button class="btn btn-dark rounded-pill px-4 mt-3" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="advSearchGateModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content text-center p-5 border-0 shadow"><div class="modal-body"><i class="fas fa-check-circle fa-4x text-success mb-4"></i><h3 class="fw-bold text-dark">Judgment Found!</h3><p class="text-muted mt-3 mb-4">Great news! The case is in our database.<br>However, <b>Advanced Search</b> is a <b>Premium Feature</b>.</p><div class="d-grid gap-2"><button class="btn btn-dark" onclick="window.location.href='#packages'; bootstrap.Modal.getInstance(document.getElementById('advSearchGateModal')).hide();">View Plans</button><button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button></div></div></div></div></div>
    <div class="modal fade" id="loginModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Member Login</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body p-4 text-center"><p class="text-muted mb-3">Login with your email address.</p><input type="email" id="loginEmailInput" class="form-control form-control-lg mb-3" placeholder="name@example.com"><button class="btn btn-dark w-100" onclick="submitLogin()">Send Magic Link</button></div></div></div></div>
    <div class="modal fade" id="checkEmailModal" tabindex="-1" data-bs-backdrop="static"><div class="modal-dialog modal-dialog-centered"><div class="modal-content text-center p-5"><div class="modal-body"><i class="fas fa-paper-plane fa-4x text-success mb-4"></i><h3 class="fw-bold mb-2">Check Your Email</h3><p class="text-muted">We have sent a login link to your email.</p><button type="button" class="btn btn-outline-success mt-3 px-4 rounded-pill" data-bs-dismiss="modal">OK</button></div></div></div></div>
    <div class="modal fade" id="premiumWarningModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header bg-warning"><h5 class="modal-title text-dark">ðŸ”’ Login Required</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body p-4 text-center"><p class="lead">This is a <strong>Premium</strong> Judgment.</p><p class="text-muted mb-4">You need to login to read the full text.</p><button class="btn btn-dark w-100" onclick="triggerLoginFromModal()">Login Now</button></div></div></div></div>
    <div class="modal fade" id="paymentModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title"><i class="fas fa-file-invoice-dollar me-2"></i> Payment Verification</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body p-4"><form id="paymentForm" action="https://formsubmit.co/caseref.bd@gmail.com" method="POST"><input type="hidden" name="_captcha" value="false"><input type="hidden" name="_subject" value="New Payment Request"><div class="mb-3"><label class="form-label">Full Name</label><input type="text" name="Name" class="form-control" required></div><div class="mb-3"><label class="form-label">Mobile Number</label><input type="text" name="Phone" class="form-control" required></div><div class="mb-3"><label class="form-label">Login Email</label><input type="email" name="Email" class="form-control" required></div><div class="row"><div class="col-md-6 mb-3"><label class="form-label">TrxID</label><input type="text" name="TrxID" class="form-control" required></div><div class="col-md-6 mb-3"><label class="form-label">Plan</label><select name="Package" class="form-select" required><option>Monthly (199)</option><option>Quarterly (499)</option><option>Half-Yearly (700)</option><option>Yearly (1200)</option></select></div></div><div class="d-grid mt-3"><button type="submit" class="btn btn-primary btn-lg">Submit Request</button></div></form></div></div></div></div>
    <div class="modal fade" id="profileModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content text-center p-4"><div class="modal-body"><h4 class="fw-bold mb-3">My Account</h4><div id="profileInfo">Checking...</div><button class="btn btn-outline-danger btn-sm mt-3 px-4" onclick="logout()">Logout</button></div></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const supabaseUrl = 'https://bxzrydybnnlzrgzdqnob.supabase.co'; 
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ4enJ5ZHlibm5senJnemRxbm9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1NTQ2MzksImV4cCI6MjA4NDEzMDYzOX0.6Ikj5At5UKhKZr6y_lhmOQ-FUDxdnJOS1ZUSf6dTgEI'; 
        const githubUser = 'LexSwordBD'; 
        const repoName = 'casereference'; 
        const siteLink = 'https://lexswordbd.github.io/casereference/';

        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);
        let currentUser = null;
        let subStatus = false;
        let subExpiry = "";
        let currentPage = 1;
        const itemsPerPage = 20;
        let currentSearchType = 'simple';

        // --- RESTORED LOGIC ---
        const lawAliases = {
            'Constitution of Bangladesh (à¦¸à¦‚à¦¬à¦¿à¦§à¦¾à¦¨)': ['Constitution', 'Konstitution', 'Art.', 'Article', 'à¦¸à¦‚à¦¬à¦¿à¦§à¦¾à¦¨'],
            'Code of Civil Procedure (CPC/à¦¦à§‡à¦“à§Ÿà¦¾à¦¨à§€)': ['CPC', 'Code of Civil Procedure', 'Civil Procedure Code', 'C.P.C', 'à¦¦à§‡à¦“à§Ÿà¦¾à¦¨à§€ à¦•à¦¾à¦°à§à¦¯à¦¬à¦¿à¦§à¦¿', 'Order', 'Rule'],
            'Code of Criminal Procedure (CrPC/à¦«à§Œà¦œà¦¦à¦¾à¦°à§€)': ['CrPC', 'Code of Criminal Procedure', 'Criminal Procedure Code', 'Cr.P.C', 'à¦«à§Œà¦œà¦¦à¦¾à¦°à§€ à¦•à¦¾à¦°à§à¦¯à¦¬à¦¿à¦§à¦¿', 'Section 144', '498'],
            'Penal Code (à¦¦à¦£à§à¦¡à¦¬à¦¿à¦§à¦¿)': ['Penal Code', 'Penal', 'PC', 'P.C', 'dondobidhi', 'à¦¦à¦£à§à¦¡à¦¬à¦¿à¦§à¦¿', '302', '304'],
            'Evidence Act (à¦¸à¦¾à¦•à§à¦·à§à¦¯ à¦†à¦‡à¦¨)': ['Evidence Act', 'Evidence', 'sakkho ain', 'à¦¸à¦¾à¦•à§à¦·à§à¦¯ à¦†à¦‡à¦¨'],
            'Limitation Act (à¦¤à¦¾à¦®à¦¾à¦¦à¦¿ à¦†à¦‡à¦¨)': ['Limitation Act', 'Limitation', 'Section 5', 'à¦¤à¦¾à¦®à¦¾à¦¦à¦¿'],
            'Specific Relief Act (à¦¸à§à¦¨à¦¿à¦°à§à¦¦à¦¿à¦·à§à¦Ÿ à¦ªà§à¦°à¦¤à¦¿à¦•à¦¾à¦°)': ['Specific Relief', 'SR Act', 'S.R. Act', 'à¦¸à§à¦¨à¦¿à¦°à§à¦¦à¦¿à¦·à§à¦Ÿ à¦ªà§à¦°à¦¤à¦¿à¦•à¦¾à¦°'],
            'Nari O Shishu Nirjatan Daman Ain (à¦¨à¦¾à¦°à§€ à¦“ à¦¶à¦¿à¦¶à§)': ['Nari O Shishu', 'Women and Children', 'Nari-O-Shishu', 'à¦¨à¦¾à¦°à§€ à¦“ à¦¶à¦¿à¦¶à§', 'à¦¨à¦¾à¦°à§€ à¦¶à¦¿à¦¶à§'],
            'Artha Rin Adalat Ain (à¦…à¦°à§à¦¥ à¦‹à¦£ à¦†à¦¦à¦¾à¦²à¦¤)': ['Artha Rin', 'Money Loan Court', 'Artha Rin Adalat', 'à¦…à¦°à§à¦¥ à¦‹à¦£'],
            'Digital Security Act (à¦¡à¦¿à¦œà¦¿à¦Ÿà¦¾à¦² à¦¨à¦¿à¦°à¦¾à¦ªà¦¤à§à¦¤à¦¾)': ['Digital Security', 'Cyber Security', 'ICT Act', 'à¦¡à¦¿à¦œà¦¿à¦Ÿà¦¾à¦² à¦¨à¦¿à¦°à¦¾à¦ªà¦¤à§à¦¤à¦¾'],
            'Narcotics Control Act (à¦®à¦¾à¦¦à¦• à¦¦à§à¦°à¦¬à§à¦¯ à¦¨à¦¿à§Ÿà¦¨à§à¦¤à§à¦°à¦£)': ['Narcotics', 'Madok', 'Drug', 'Table 9(Ka)', 'à¦®à¦¾à¦¦à¦•', 'Heroin', 'Yaba'],
            'Special Powers Act (à¦¬à¦¿à¦¶à§‡à¦· à¦•à§à¦·à¦®à¦¤à¦¾)': ['Special Powers Act', 'SPA', 'Special Powers', 'à¦¬à¦¿à¦¶à§‡à¦· à¦•à§à¦·à¦®à¦¤à¦¾'],
            'Anti-Terrorism Act (à¦¸à¦¨à§à¦¤à§à¦°à¦¾à¦¸ à¦¬à¦¿à¦°à§‹à¦§à§€)': ['Anti-Terrorism', 'Terrorism', 'à¦¸à¦¨à§à¦¤à§à¦°à¦¾à¦¸ à¦¬à¦¿à¦°à§‹à¦§à§€'],
            'Arms Act (à¦…à¦¸à§à¦¤à§à¦° à¦†à¦‡à¦¨)': ['Arms Act', 'à¦…à¦¸à§à¦¤à§à¦° à¦†à¦‡à¦¨', 'Arms'],
            'Ain Srinkhola Bighnokari (à¦¦à§à¦°à§à¦¤ à¦¬à¦¿à¦šà¦¾à¦°)': ['Druto Bichar', 'Speedy Trial', 'à¦¦à§à¦°à§à¦¤ à¦¬à¦¿à¦šà¦¾à¦°'],
            'Mobile Court Act (à¦®à§‹à¦¬à¦¾à¦‡à¦² à¦•à§‹à¦°à§à¦Ÿ)': ['Mobile Court', 'à¦®à§‹à¦¬à¦¾à¦‡à¦² à¦•à§‹à¦°à§à¦Ÿ'],
            'Transfer of Property Act (à¦¸à¦®à§à¦ªà¦¤à§à¦¤à¦¿ à¦¹à¦¸à§à¦¤à¦¾à¦¨à§à¦¤à¦°)': ['Transfer of Property', 'TP Act', 'T.P. Act', 'à¦¸à¦®à§à¦ªà¦¤à§à¦¤à¦¿ à¦¹à¦¸à§à¦¤à¦¾à¦¨à§à¦¤à¦°'],
            'Contract Act (à¦šà§à¦•à§à¦¤à¦¿ à¦†à¦‡à¦¨)': ['Contract Act', 'à¦šà§à¦•à§à¦¤à¦¿ à¦†à¦‡à¦¨'],
            'Registration Act (à¦°à§‡à¦œà¦¿à¦¸à§à¦Ÿà§à¦°à§‡à¦¶à¦¨)': ['Registration Act', 'à¦°à§‡à¦œà¦¿à¦¸à§à¦Ÿà§à¦°à§‡à¦¶à¦¨'],
            'State Acquisition & Tenancy Act (à¦ªà§à¦°à¦œà¦¾à¦¸à§à¦¬à¦¤à§à¦¬)': ['State Acquisition', 'SAT Act', 'Non-Agricultural', 'à¦ªà§à¦°à¦œà¦¾à¦¸à§à¦¬à¦¤à§à¦¬', 'Land Survey'],
            'Vested Property Return Act (à¦…à¦°à§à¦ªà¦¿à¦¤ à¦¸à¦®à§à¦ªà¦¤à§à¦¤à¦¿)': ['Vested Property', 'Enemy Property', 'à¦…à¦°à§à¦ªà¦¿à¦¤ à¦¸à¦®à§à¦ªà¦¤à§à¦¤à¦¿', 'Vested'],
            'Muslim Family Laws (à¦®à§à¦¸à¦²à¦¿à¦® à¦ªà¦¾à¦°à¦¿à¦¬à¦¾à¦°à¦¿à¦• à¦†à¦‡à¦¨)': ['Muslim Family', 'Muslim Law', 'à¦®à§à¦¸à¦²à¦¿à¦® à¦ªà¦¾à¦°à¦¿à¦¬à¦¾à¦°à¦¿à¦•'],
            'Family Courts Ordinance (à¦ªà¦¾à¦°à¦¿à¦¬à¦¾à¦°à¦¿à¦• à¦†à¦¦à¦¾à¦²à¦¤)': ['Family Courts', 'Family Court', 'à¦ªà¦¾à¦°à¦¿à¦¬à¦¾à¦°à¦¿à¦• à¦†à¦¦à¦¾à¦²à¦¤'],
            'Guardians and Wards Act (à¦…à¦­à¦¿à¦­à¦¾à¦¬à¦• à¦“ à¦ªà§à¦°à¦¤à¦¿à¦ªà¦¾à¦²à§à¦¯)': ['Guardians and Wards', 'Guardian', 'à¦…à¦­à¦¿à¦­à¦¾à¦¬à¦•'],
            'Hindu Law (à¦¹à¦¿à¦¨à§à¦¦à§ à¦†à¦‡à¦¨)': ['Hindu Law', 'Hindu', 'à¦¹à¦¿à¦¨à§à¦¦à§'],
            'Negotiable Instruments Act (NI Act/à¦šà§‡à¦• à¦¡à¦¿à¦œà¦…à¦¨à¦¾à¦°)': ['Negotiable Instruments', 'NI Act', 'N.I. Act', '138', 'Dishonour of Cheque', 'à¦šà§‡à¦• à¦¡à¦¿à¦œà¦…à¦¨à¦¾à¦°'],
            'Bangladesh Labor Act (à¦¶à§à¦°à¦® à¦†à¦‡à¦¨)': ['Labor Act', 'Labour Act', 'Labour Law', 'Employment of Labour', 'Srom Ain', 'à¦¶à§à¦°à¦® à¦†à¦‡à¦¨'],
            'Companies Act (à¦•à§‹à¦®à§à¦ªà¦¾à¦¨à¦¿ à¦†à¦‡à¦¨)': ['Companies Act', 'Company Law', 'Winding up', 'à¦•à§‹à¦®à§à¦ªà¦¾à¦¨à¦¿'],
            'Bank Company Act (à¦¬à§à¦¯à¦¾à¦‚à¦• à¦•à§‹à¦®à§à¦ªà¦¾à¦¨à¦¿)': ['Bank Company', 'Banking'],
            'Bankruptcy Act (à¦¦à§‡à¦‰à¦²à¦¿à§Ÿà¦¾ à¦†à¦‡à¦¨)': ['Bankruptcy', 'Deuliya'],
            'VAT Act (à¦­à§à¦¯à¦¾à¦Ÿ à¦†à¦‡à¦¨)': ['Value Added Tax', 'VAT', 'à¦­à§à¦¯à¦¾à¦Ÿ'],
            'Income Tax Ordinance (à¦†à§Ÿà¦•à¦°)': ['Income Tax', 'Tax', 'à¦†à§Ÿà¦•à¦°'],
            'Customs Act (à¦•à¦¾à¦¸à§à¦Ÿà¦®à¦¸)': ['Customs', 'Custom'],
            'Right to Information Act (à¦¤à¦¥à§à¦¯ à¦…à¦§à¦¿à¦•à¦¾à¦°)': ['Right to Information', 'RTI', 'à¦¤à¦¥à§à¦¯ à¦…à¦§à¦¿à¦•à¦¾à¦°'],
            'Road Transport Act (à¦¸à§œà¦• à¦ªà¦°à¦¿à¦¬à¦¹à¦¨)': ['Road Transport', 'Motor Vehicle', 'à¦¸à§œà¦• à¦ªà¦°à¦¿à¦¬à¦¹à¦¨']
        };
        const stopwords = ['a', 'an', 'the', 'of', 'in', 'and', 'or', 'is', 'are', 'was', 'were', 'be', 'to', 'for', 'with', 'on', 'at', 'by', 'from', 'shall', 'will', 'am'];

        async function checkAuth() {
            const { data: { session } } = await _supabase.auth.getSession();
            const authDiv = document.getElementById('authDiv');
            if (session) {
                currentUser = session.user;
                const { data } = await _supabase.from('members').select('*').eq('email', currentUser.email).single();
                if(data && new Date(data.expiry_date) > new Date()) { subStatus = true; subExpiry = new Date(data.expiry_date).toDateString(); }
                else { subStatus = false; subExpiry = "Expired / Free"; }
                authDiv.innerHTML = `<button class="btn btn-outline-dark btn-sm rounded-pill px-3 fw-bold" data-bs-toggle="modal" data-bs-target="#profileModal"><i class="fas fa-user-circle"></i> ${subStatus ? 'Premium' : 'My Account'}</button>`;
                document.getElementById('profileInfo').innerHTML = `<p class="fw-bold text-primary mb-1">${currentUser.email}</p><span class="badge ${subStatus ? 'bg-success' : 'bg-warning text-dark'}">${subStatus ? 'Active' : 'Expired'}</span><p class="small text-muted mt-2">Valid Till: ${subExpiry}</p>`;
            } else {
                authDiv.innerHTML = `<button class="btn btn-dark btn-sm rounded-pill px-4 fw-bold" onclick="openLoginModal()">Login</button>`;
            }
        }
        checkAuth();

        function openLoginModal() { document.getElementById('loginEmailInput').value = ''; new bootstrap.Modal(document.getElementById('loginModal')).show(); }
        async function submitLogin() {
            const email = document.getElementById('loginEmailInput').value;
            if(!email) { alert("Please enter a valid email."); return; }
            bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
            const { error } = await _supabase.auth.signInWithOtp({ email, options: { emailRedirectTo: siteLink } });
            if(!error) new bootstrap.Modal(document.getElementById('checkEmailModal')).show();
            else alert("Error: " + error.message);
        }
        function triggerLoginFromModal() { bootstrap.Modal.getInstance(document.getElementById('premiumWarningModal')).hide(); openLoginModal(); }
        async function logout() { await _supabase.auth.signOut(); location.reload(); }
        function toggleAdvSearch() { document.getElementById('advSearchForm').style.display = document.getElementById('advSearchForm').style.display === 'block' ? 'none' : 'block'; }
        function resetHome() { location.reload(); }
        document.querySelectorAll('.nav-link-close').forEach(item => { item.addEventListener('click', () => { const toggler = document.querySelector('.navbar-toggler'); const collapse = document.querySelector('.navbar-collapse'); if (window.getComputedStyle(toggler).display !== 'none' && collapse.classList.contains('show')) toggler.click(); }); });
        function showSection(sec) { document.getElementById('packages').style.display = 'block'; document.getElementById('featuresSection').style.display = 'block'; document.getElementById('bookmarkArea').style.display = 'none'; document.getElementById('homeSection').scrollIntoView({behavior: 'smooth'}); }
        async function showMyBookmarks() { if(!currentUser) { openLoginModal(); return; } document.getElementById('homeSection').style.padding = "20px 0"; document.getElementById('featuresSection').style.display = 'none'; document.getElementById('packages').style.display = 'none'; document.getElementById('resultsArea').innerHTML = ""; document.getElementById('readerView').style.display = "none"; document.getElementById('paginationNav').style.display = "none"; const bmArea = document.getElementById('bookmarkArea'); bmArea.style.display = 'block'; const list = document.getElementById('bookmarkList'); list.innerHTML = '<div class="text-center"><div class="spinner-border"></div></div>'; const { data, error } = await _supabase.from('bookmarks').select('*').eq('email', currentUser.email); if(!data || data.length === 0) { list.innerHTML = '<div class="alert alert-secondary">No bookmarks found.</div>'; return; } list.innerHTML = ""; data.forEach(item => { const div = document.createElement('div'); div.className = 'result-card'; div.onclick = () => loadJudgment({title: item.case_title, citation: item.case_citation, case_anchor: item.case_anchor, github_filename: item.github_filename, is_premium: true}); div.innerHTML = `<h6>${item.case_title}</h6><span class="badge bg-secondary">${item.case_citation}</span>`; list.appendChild(div); }); }

        function triggerSearch(page, type = null) { if (type) currentSearchType = type; performSearch(page); }

        async function performSearch(page = 1) {
            currentPage = page;
            const resultsDiv = document.getElementById('resultsArea');
            const paginationNav = document.getElementById('paginationNav');
            
            // Clean UI
            document.getElementById('readerView').style.display = 'none';
            document.getElementById('bookmarkArea').style.display = 'none';
            document.getElementById('paywallMsg').style.display = 'none';
            document.getElementById('packages').style.display = 'none';
            document.getElementById('featuresSection').style.display = 'none';
            
            // HERO SHRINK LOGIC (SCROLL FIX)
            document.getElementById('homeSection').classList.add('shrunk');

            const lawFilterVal = document.getElementById('lawFilterInput').value.trim();
            const searchText = document.getElementById('searchInput').value.trim();

            if (currentSearchType !== 'advanced' && !searchText && !lawFilterVal) {
                alert("Please enter keywords or select a law.");
                return;
            }

            resultsDiv.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-primary"></div></div>';
            
            let queryBuilder = _supabase.from('cases').select('*', { count: 'exact' });
            let highlightTerm = "";

            if (currentSearchType === 'advanced') {
                const jour = document.getElementById('advJournal').value;
                const vol = document.getElementById('advVol').value;
                const div = document.getElementById('advDiv').value;
                const pg = document.getElementById('advPage').value;
                if (!jour || !vol || !div || !pg) { alert("All fields are required for Advanced Search."); resultsDiv.innerHTML = ""; document.getElementById('featuresSection').style.display = 'block'; return; }
                queryBuilder = queryBuilder.eq('journal', jour).eq('volume', vol).eq('division', div).eq('page_number', pg);
                highlightTerm = `${jour} ${vol} ${pg}`;
            } else {
                const isExact = document.getElementById('exactMatchToggle').checked;
                let aliasCondition = "";
                if(lawFilterVal) {
                    const aliases = lawAliases[lawFilterVal] || [lawFilterVal];
                    aliasCondition = aliases.map(a => `headnote.ilike.%${a}%`).join(',');
                }

                if (isExact) {
                    let queryStr = `headnote.ilike.%${searchText}%,title.ilike.%${searchText}%`;
                    if(aliasCondition) queryBuilder = queryBuilder.or(aliasCondition).or(queryStr);
                    else queryBuilder = queryBuilder.or(queryStr);
                    highlightTerm = searchText;
                } else {
                    const words = searchText.split(/\s+/).filter(w => !stopwords.includes(w.toLowerCase()) && w.length > 1);
                    let searchCondition = words.length > 0 ? words.map(w => `headnote.ilike.%${w}%,title.ilike.%${w}%`).join(',') : `headnote.ilike.%${searchText}%,title.ilike.%${searchText}%`;
                    
                    if(aliasCondition) queryBuilder = queryBuilder.or(aliasCondition);
                    if(searchCondition) queryBuilder = queryBuilder.or(searchCondition);
                    highlightTerm = words.join('|');
                }
            }

            const from = (page - 1) * itemsPerPage;
            const to = from + itemsPerPage - 1;
            const { data, error, count } = await queryBuilder.range(from, to).order('page_number', { ascending: true });

            if (currentSearchType === 'advanced' && (!currentUser || !subStatus)) {
                if (count > 0) {
                    new bootstrap.Modal(document.getElementById('advSearchGateModal')).show();
                    resultsDiv.innerHTML = '';
                    document.getElementById('featuresSection').style.display = 'block';
                    return;
                }
            }

            if (error || !data || data.length === 0) {
                resultsDiv.innerHTML = '<div class="text-center mt-5 text-muted"><h5>No cases found.</h5></div>';
                document.getElementById('packages').style.display = 'block';
                paginationNav.style.display = 'none';
                return;
            }

            resultsDiv.innerHTML = `<p class="text-muted small mb-3 ms-1">Found ${count} results (Page ${page})</p>`;
            
            data.forEach(item => {
                const safeHeadnote = item.headnote || "";
                const highlightedHeadnote = highlightText(safeHeadnote, highlightTerm || lawFilterVal);
                
                let citationHtml = (currentUser && subStatus) 
                    ? `<span class="badge bg-light text-dark border">${item.citation}</span> ${item.parallel_citations ? '| ' + item.parallel_citations : ''}`
                    : `<span class="badge bg-secondary opacity-50"><i class="fas fa-lock small"></i> Premium Only</span>`;

                const div = document.createElement('div');
                div.className = 'result-card';
                div.onclick = () => loadJudgment(item);
                div.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start">
                        <h5 class="mb-1" style="color:#1a237e; font-weight:700;">${item.title}</h5>
                        ${item.is_premium ? '<i class="fas fa-lock text-danger small"></i>' : '<i class="fas fa-unlock text-success small"></i>'}
                    </div>
                    <div class="mb-2">${citationHtml} <span class="small text-muted ms-1">${item.division || ''}</span></div>
                    <div class="headnote-text">${highlightedHeadnote}</div>
                `;
                resultsDiv.appendChild(div);
            });
            renderPagination(count, page);
        }

        function renderPagination(totalItems, currentPage) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const nav = document.getElementById('paginationNav');
            const list = document.getElementById('paginationList');
            if (totalPages <= 1) { nav.style.display = 'none'; return; }
            nav.style.display = 'block'; list.innerHTML = '';
            
            list.innerHTML += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}"><button class="page-link" onclick="triggerSearch(${currentPage - 1})">Prev</button></li>`;
            let start = Math.max(1, currentPage - 2);
            let end = Math.min(totalPages, start + 4);
            if(end - start < 4) start = Math.max(1, end - 4);
            for(let i=start; i<=end; i++) list.innerHTML += `<li class="page-item ${i === currentPage ? 'active' : ''}"><button class="page-link" onclick="triggerSearch(${i})">${i}</button></li>`;
            list.innerHTML += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}"><button class="page-link" onclick="triggerSearch(${currentPage + 1})">Next</button></li>`;
        }

        function highlightText(text, keyword) {
            if (!keyword) return text;
            const parts = keyword.split('|').filter(k => k.length > 0);
            let highlighted = text;
            parts.forEach(part => {
                try {
                    const regex = new RegExp(`(${part})`, "gi");
                    highlighted = highlighted.replace(regex, '<span class="highlight">$1</span>');
                } catch(e) {}
            });
            return highlighted;
        }

        async function loadJudgment(item) {
            if (item.is_premium && !currentUser) { new bootstrap.Modal(document.getElementById('premiumWarningModal')).show(); return; }
            if (item.is_premium && !subStatus) { document.getElementById('paywallMsg').style.display = 'block'; document.getElementById('resultsArea').innerHTML = ''; return; }
            
            document.getElementById('resultsArea').innerHTML = '';
            document.getElementById('paginationNav').style.display = 'none';
            const viewer = document.getElementById('readerView');
            viewer.style.display = 'block';
            viewer.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-secondary"></div></div>';
            
            try {
                const url = `https://raw.githubusercontent.com/${githubUser}/${repoName}/main/judgments/${item.github_filename}`;
                const res = await fetch(url);
                const fullText = await res.text();
                const start = `===${item.case_anchor}===`;
                const end = `===End===`;
                const sIdx = fullText.indexOf(start);
                let content = sIdx !== -1 ? fullText.substring(sIdx + start.length, fullText.indexOf(end, sIdx)) : "Content Error";
                const searchTerm = document.getElementById('searchInput').value;
                if(searchTerm) content = highlightText(content, searchTerm.replace(/\s+/g, '|'));

                viewer.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center mb-4 no-print">
                        <button class="btn btn-light btn-sm border" onclick="location.reload()"><i class="fas fa-arrow-left"></i> Back</button>
                        <div class="d-flex gap-2"><button class="btn-action btn-outline-warning text-dark border" onclick="toggleBookmark('${item.title}', '${item.citation}', '${item.case_anchor}', '${item.github_filename}')"><i class="far fa-bookmark"></i> Save</button><button class="btn-action btn-outline-secondary border" onclick="window.print()"><i class="fas fa-print"></i> Print</button></div>
                    </div>
                    <h4 class="text-center fw-bold" style="color:#1a237e">${item.title}</h4>
                    <p class="text-center text-muted fw-bold border-bottom pb-3">${item.citation} ${item.parallel_citations ? ' | ' + item.parallel_citations : ''}</p>
                    <div class="mt-4" style="text-align: justify; font-size:18px; line-height:1.8; white-space: pre-wrap;">${content}</div>
                `;
            } catch (e) { viewer.innerHTML = "Error loading judgment."; }
        }

        async function toggleBookmark(title, citation, anchor, file) {
            if(!currentUser) { alert("Please Login."); return; }
            const { error } = await _supabase.from('bookmarks').insert([{ email: currentUser.email, case_title: title, case_citation: citation, case_anchor: anchor, github_filename: file }]);
            if(error) alert("Already saved."); else alert("Saved!");
        }
    </script>
</body>
</html>